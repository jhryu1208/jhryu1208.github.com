---
layout: post
title:  "[BigQuery] DECLARE"
subtitle: "[BigQuery] DECLARE"
categories: gcp
tags: bigquery
comments: true
---
####  Contents
- 기본형식
- 예제

<br>

본 포스팅은 Bigquery의  DECLARE에 관한 간단한 내용을 담고 있습니다.

---

DECLARE은 말 그대로 특정 유형의 변수를 선언 혹은 초기화할 때 사용합니다. (파이썬의 변수선언과 유사한 것 같다.)

<br>

### 기본형식

```sql
DECLARE variable_name[, ...] [variable_type] [DEFAULT expression];
```

- `DECLARE` 문은 다음의 위치에서만 사용할 수 있습니다.
    - Query 스크립트 시작 부분
    - `BEGIN`으로 선언된 블록의 시작 부분

<br>

- `variable_name` : valid identifier
    - 대소문자를 구분하지 않는다.  (eg. name = Name = NAME)
    - 단 하나의 `DECLARE`문에 `variable_name`은 여러번 지정할 수 있습니다.

- `variable_type` : bigquery type
    - `DEFAULT`와 함께 expression을 지정해주면, `varibable_name`이라는 변수가 expression값으로 초기화된다. 이때, 변수는 지정한 expression의 Data type으로 강제변환됩니다.
    - 반대로, `DEFAULT`절을 지정해주지않으면, 생성 시켜준 객체가 `NULL`로 초기화됩니다.
    - `varibale_type` 과 expression의 경우 `variable_name`과 달리 여러번 나타낼 수 없다. 즉 단 하나만 지정할 수 있습니다.
    - `variable_type` 을 지정하지 않을 경우, 반드시 `DEFAULT` 절을 지정해줘야합니다.

<br>

- 주의점
    - 파이썬과 다르게 이전 `DECLARE` 문에서 지정한 `varibale_name` 의 이름을 중복으로 사용할 수 없습니다.

<br>

---

### 예시

#### DEFAULT절을 생략했을 때

`DEFAULT`절을 **생략할 경우** 다음과 같이 지정한 변수가 NULL값으로 초기화합니다.


![Untitled](https://user-images.githubusercontent.com/53929665/122646166-cd805900-d158-11eb-885f-2f39b053d952.png)

<br>

#### DEFAULT절을 지정했을 때

`DEFAULT` 절을 **지정할 경우** x, y, z 변수가 모두 0으로 초기화되는 것을 확인할 수 있습니다.

![Untitled 1](https://user-images.githubusercontent.com/53929665/122646159-cbb69580-d158-11eb-8dcb-9482dc1898c6.png)

<br>

#### variable_type을 지정하지 않을 때

`variable_type`을 지정하지 않을 수 있다. 하지만, 이 경우에는 반드시 `DEFAULT`절을 지정해야한다. 이때, 변수 x는 expression에서 지정한 값의 data type으로 강제변환(coerce)된다. 즉, 아래의 예제에서는 변수 x는 DATE type으로 강제변환된 것을 확인할 수 있다.


![Untitled 2](https://user-images.githubusercontent.com/53929665/122646161-cc4f2c00-d158-11eb-84f6-3d09d2f29973.png)

따라서, varible_type을 expression의 Data type과 다르게 지정할 경우 아래와 같이 오류메시지를 확인할 수 있다.

![Untitled 3](https://user-images.githubusercontent.com/53929665/122646162-cc4f2c00-d158-11eb-8bef-3e61382d5596.png)

![Untitled 4](https://user-images.githubusercontent.com/53929665/122646163-cce7c280-d158-11eb-8b40-5f4173835e26.png)

<br>

#### 쿼리의 결과로  변수 초기화!

쿼리의 결과를 expression으로 지정 할 수 있습니다.(*expression의 특성 상 오직 하나의 값만 사용할 수 있어서 아래의 예제에서 볼 수 있듯이 LIMIT절을 추가하였습니다).  특정 목적을 가지는 쿼리의 경우는 이와 같은 방법을 유용하게 이용할 수 있을 것 같네요. 예를들어 테이블의 특정 target의 고유 레코드의 필드 값 중 실시간으로 변동하는 값을 변수로 이용하는 경우 라던가... 🤔 🤔  🤔

![DECLARE%2056c5e40b96524cfa9413898e3ce9d00f/Untitled%205.png
![Untitled 5](https://user-images.githubusercontent.com/53929665/122646165-cce7c280-d158-11eb-8e6b-1ad198473c8d.png)

<br>

---

### References

- [Google Colud Bigquery  Document : DECLARE](https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting#declare)

